Migrations are generated based on changes made by the agent in your app, learn more.
CREATE TABLE "user_stories" (
	"id" serial PRIMARY KEY NOT NULL,
	"user_id" varchar NOT NULL,
	"media_url" text NOT NULL,
	"media_type" varchar(10) NOT NULL,
	"caption" text,
	"expires_at" timestamp NOT NULL,
	"view_count" integer DEFAULT 0,
	"created_at" timestamp DEFAULT now() NOT NULL
);
CREATE TABLE "story_views" (
	"id" serial PRIMARY KEY NOT NULL,
	"story_id" integer NOT NULL,
	"viewer_id" varchar NOT NULL,
	"viewed_at" timestamp DEFAULT now() NOT NULL
);
ALTER TABLE "notification_history" DISABLE ROW LEVEL SECURITY;
ALTER TABLE "user_notification_preferences" DISABLE ROW LEVEL SECURITY;
DROP TABLE "notification_history" CASCADE;
DROP TABLE "user_notification_preferences" CASCADE;
ALTER TABLE "email_verification_tokens" DROP CONSTRAINT "email_verification_tokens_token_key";
ALTER TABLE "password_reset_tokens" DROP CONSTRAINT "password_reset_tokens_token_key";
ALTER TABLE "user_sessions" DROP CONSTRAINT "user_sessions_token_key";
ALTER TABLE "auth_audit_log" DROP CONSTRAINT "auth_audit_log_user_id_fkey";
ALTER TABLE "email_verification_tokens" DROP CONSTRAINT "email_verification_tokens_user_id_fkey";
ALTER TABLE "password_reset_tokens" DROP CONSTRAINT "password_reset_tokens_user_id_fkey";
ALTER TABLE "user_sessions" DROP CONSTRAINT "user_sessions_user_id_fkey";
DROP INDEX "idx_notifications_user_created";
DROP INDEX "idx_notifications_user_read";
DROP INDEX "idx_users_email";
DROP INDEX "idx_user_journeys_user";
DROP INDEX "idx_user_streaks_user_id";
DROP INDEX "idx_push_subscriptions_endpoint";
DROP INDEX "idx_push_subscriptions_user_id";
DROP INDEX "idx_auth_audit_log_action";
DROP INDEX "idx_auth_audit_log_created_at";
DROP INDEX "idx_auth_audit_log_user";
DROP INDEX "idx_auth_audit_log_user_id";
DROP INDEX "idx_sparks_audio_metadata";
DROP INDEX "idx_sparks_daily_date";
DROP INDEX "idx_sparks_featured";
DROP INDEX "idx_sparks_status";
DROP INDEX "idx_email_verification_tokens_token";
DROP INDEX "idx_email_verification_tokens_user_id";
DROP INDEX "idx_scheduled_notifications_pending";
DROP INDEX "idx_password_reset_tokens_token";
DROP INDEX "idx_password_reset_tokens_user_id";
DROP INDEX "idx_user_sessions_expires_at";
DROP INDEX "idx_user_sessions_token";
DROP INDEX "idx_user_sessions_user_id";
ALTER TABLE "users" ALTER COLUMN "auth_provider" SET DATA TYPE varchar;
ALTER TABLE "users" ALTER COLUMN "auth_provider" SET DEFAULT 'replit';
ALTER TABLE "prayer_subscriptions" ALTER COLUMN "reminder_time" SET DEFAULT '00:01';
ALTER TABLE "prayer_subscriptions" ADD COLUMN "last_reminder_sent_at" timestamp;
ALTER TABLE "user_stories" ADD CONSTRAINT "user_stories_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "story_views" ADD CONSTRAINT "story_views_story_id_user_stories_id_fk" FOREIGN KEY ("story_id") REFERENCES "public"."user_stories"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "story_views" ADD CONSTRAINT "story_views_viewer_id_users_id_fk" FOREIGN KEY ("viewer_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "auth_audit_log" ADD CONSTRAINT "auth_audit_log_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE set null ON UPDATE no action;
ALTER TABLE "email_verification_tokens" ADD CONSTRAINT "email_verification_tokens_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "password_reset_tokens" ADD CONSTRAINT "password_reset_tokens_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "user_sessions" ADD CONSTRAINT "user_sessions_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;
ALTER TABLE "email_verification_tokens" ADD CONSTRAINT "email_verification_tokens_token_unique" UNIQUE("token");
ALTER TABLE "password_reset_tokens" ADD CONSTRAINT "password_reset_tokens_token_unique" UNIQUE("token");
ALTER TABLE "user_sessions" ADD CONSTRAINT "user_sessions_token_unique" UNIQUE("token");