/**
 * Shared Type Definitions
 * 
 * Central type definitions used across client and server.
 * Ensures type consistency throughout the platform.
 */

// ============================================================================
// User Types
// ============================================================================

export type UserRole = 'member' | 'leader' | 'admin' | 'super_admin';

export interface User {
  id: string;
  email: string;
  firstName: string | null;
  lastName: string | null;
  profileImageUrl: string | null;
  role: UserRole;
  createdAt: Date;
  updatedAt: Date;
}

export interface UserProfile extends User {
  spiritualProfile: SpiritualProfile | null;
  preferences: UserPreferences;
  stats: UserStats;
}

export interface SpiritualProfile {
  id: number;
  userId: string;
  wheelOfLifeScores: WheelOfLifeScores;
  primaryGrowthAreas: string[];
  spiritualGifts: string[];
  assessmentCompletedAt: Date;
  updatedAt: Date;
}

export interface WheelOfLifeScores {
  faith: number;
  family: number;
  finances: number;
  fitness: number;
  friends: number;
  fun: number;
  career: number;
  contribution: number;
}

export interface UserPreferences {
  notificationSettings: NotificationSettings;
  displaySettings: DisplaySettings;
  privacySettings: PrivacySettings;
}

export interface NotificationSettings {
  dailyReminders: boolean;
  dailyReminderTime: string; // HH:mm format
  streakAlerts: boolean;
  groupNotifications: boolean;
  emailDigest: 'none' | 'daily' | 'weekly';
  pushEnabled: boolean;
}

export interface DisplaySettings {
  theme: 'light' | 'dark' | 'system';
  fontSize: 'small' | 'medium' | 'large';
  reducedMotion: boolean;
  highContrast: boolean;
}

export interface PrivacySettings {
  profileVisibility: 'private' | 'group' | 'public';
  showStreak: boolean;
  showProgress: boolean;
  allowAccountabilityRequests: boolean;
}

export interface UserStats {
  totalDaysCompleted: number;
  currentStreak: number;
  longestStreak: number;
  journeysCompleted: number;
  readingPlansCompleted: number;
  totalReflections: number;
  memberSince: Date;
}

// ============================================================================
// Content Types
// ============================================================================

export interface ReadingPlan {
  id: number;
  title: string;
  description: string;
  category: ContentCategory;
  difficulty: DifficultyLevel;
  totalDays: number;
  estimatedMinutesPerDay: number;
  imageUrl: string | null;
  isFeatured: boolean;
  isPublished: boolean;
  publishedAt: Date | null;
  tags: string[];
  targetAudience: string[];
  createdAt: Date;
  updatedAt: Date;
}

export interface ReadingPlanDay {
  id: number;
  planId: number;
  dayNumber: number;
  title: string;
  scriptureReference: string;
  scriptureText: string;
  devotionalContent: string;
  reflectionPrompts: string[];
  applicationSteps: string[];
  prayerFocus: string | null;
  audioUrl: string | null;
  estimatedMinutes: number;
}

export interface Journey {
  id: number;
  title: string;
  subtitle: string | null;
  description: string;
  category: ContentCategory;
  difficulty: DifficultyLevel;
  totalDays: number;
  imageUrl: string | null;
  isFeatured: boolean;
  isPublished: boolean;
  publishedAt: Date | null;
  prerequisites: number[]; // Journey IDs
  outcomes: string[];
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
}

export interface JourneyDay {
  id: number;
  journeyId: number;
  dayNumber: number;
  title: string;
  description: string | null;
  scriptureReference: string | null;
  scriptureText: string | null;
  teachingContent: string;
  videoUrl: string | null;
  audioUrl: string | null;
  estimatedMinutes: number;
}

export interface JourneyStep {
  id: number;
  journeyDayId: number;
  stepNumber: number;
  type: StepType;
  title: string;
  content: string;
  isRequired: boolean;
  metadata: Record<string, unknown>;
}

export type StepType = 
  | 'scripture' 
  | 'teaching' 
  | 'reflection' 
  | 'action' 
  | 'prayer' 
  | 'video' 
  | 'audio'
  | 'quiz'
  | 'journal';

export interface Spark {
  id: number;
  title: string;
  content: string;
  category: ContentCategory;
  scriptureReference: string | null;
  audioUrl: string | null;
  imageUrl: string | null;
  tags: string[];
  isPublished: boolean;
  scheduledFor: Date | null;
  createdAt: Date;
}

// ============================================================================
// Goal Types
// ============================================================================

export interface GoalTemplate {
  id: number;
  title: string;
  description: string | null;
  category: ContentCategory;
  mode: GoalMode;
  defaultActions: string[];
  suggestedHabits: HabitSuggestion[];
  reflectionPrompts: string[];
  milestones: MilestoneTemplate[];
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

export interface HabitSuggestion {
  title: string;
  description: string;
  frequency: HabitFrequency;
  category: ContentCategory;
}

export interface MilestoneTemplate {
  title: string;
  description: string;
  dayOffset: number; // Days from goal start
}

export type GoalMode = 'classic' | 'faith';
export type HabitFrequency = 'daily' | 'weekly' | 'custom';

export interface UserGoal {
  id: number;
  userId: string;
  templateId: number | null;
  title: string;
  description: string | null;
  category: ContentCategory;
  mode: GoalMode;
  targetDate: Date | null;
  status: GoalStatus;
  progress: number; // 0-100
  habits: UserHabit[];
  milestones: UserMilestone[];
  reflections: GoalReflection[];
  createdAt: Date;
  updatedAt: Date;
}

export type GoalStatus = 'active' | 'paused' | 'completed' | 'abandoned';

export interface UserHabit {
  id: number;
  goalId: number;
  title: string;
  description: string | null;
  frequency: HabitFrequency;
  customSchedule: number[] | null; // Days of week (0-6) for custom
  completions: HabitCompletion[];
  currentStreak: number;
  longestStreak: number;
  createdAt: Date;
}

export interface HabitCompletion {
  id: number;
  habitId: number;
  completedAt: Date;
  notes: string | null;
}

export interface UserMilestone {
  id: number;
  goalId: number;
  title: string;
  description: string | null;
  targetDate: Date;
  completedAt: Date | null;
  notes: string | null;
}

export interface GoalReflection {
  id: number;
  goalId: number;
  weekNumber: number;
  content: string;
  mood: number; // 1-5
  challenges: string[];
  wins: string[];
  createdAt: Date;
}

// ============================================================================
// Progress Types
// ============================================================================

export interface UserReadingPlanProgress {
  id: number;
  userId: string;
  planId: number;
  startedAt: Date;
  completedAt: Date | null;
  currentDay: number;
  completedDays: number[];
  currentStreak: number;
  longestStreak: number;
  lastActivityAt: Date;
}

export interface UserJourneyProgress {
  id: number;
  userId: string;
  journeyId: number;
  startedAt: Date;
  completedAt: Date | null;
  currentDay: number;
  completedDays: number[];
  completedSteps: number[];
  lastActivityAt: Date;
}

export interface JournalEntry {
  id: number;
  userId: string;
  contextType: JournalContextType;
  contextId: number | null;
  content: string;
  isPrivate: boolean;
  tags: string[];
  createdAt: Date;
  updatedAt: Date;
}

export type JournalContextType = 
  | 'general' 
  | 'reading_plan_day' 
  | 'journey_step' 
  | 'spark' 
  | 'goal_reflection'
  | 'prayer';

// ============================================================================
// Group Types
// ============================================================================

export interface Group {
  id: number;
  name: string;
  description: string | null;
  type: GroupType;
  imageUrl: string | null;
  leaderId: string;
  maxMembers: number | null;
  isPublic: boolean;
  joinCode: string | null;
  settings: GroupSettings;
  createdAt: Date;
}

export type GroupType = 'small_group' | 'accountability' | 'study' | 'lab';

export interface GroupSettings {
  allowMemberInvites: boolean;
  requireApproval: boolean;
  showMemberProgress: boolean;
  enableDiscussions: boolean;
  enablePrayerRequests: boolean;
}

export interface GroupMember {
  id: number;
  groupId: number;
  userId: string;
  role: GroupMemberRole;
  joinedAt: Date;
  lastActiveAt: Date;
}

export type GroupMemberRole = 'member' | 'facilitator' | 'leader';

export interface GroupLab {
  id: number;
  groupId: number;
  title: string;
  description: string;
  journeyId: number | null;
  scheduledAt: Date;
  duration: number; // minutes
  maxParticipants: number | null;
  status: LabStatus;
  meetingUrl: string | null;
  createdAt: Date;
}

export type LabStatus = 'scheduled' | 'in_progress' | 'completed' | 'cancelled';

export interface Discussion {
  id: number;
  groupId: number;
  authorId: string;
  contextType: DiscussionContextType;
  contextId: number | null;
  title: string | null;
  content: string;
  isPinned: boolean;
  isLocked: boolean;
  replyCount: number;
  createdAt: Date;
  updatedAt: Date;
}

export type DiscussionContextType = 'general' | 'journey_day' | 'reading_plan_day' | 'prayer';

export interface DiscussionReply {
  id: number;
  discussionId: number;
  authorId: string;
  content: string;
  createdAt: Date;
  updatedAt: Date;
}

export interface PrayerRequest {
  id: number;
  groupId: number | null;
  authorId: string;
  title: string;
  content: string;
  isAnonymous: boolean;
  isAnswered: boolean;
  answeredAt: Date | null;
  prayerCount: number;
  createdAt: Date;
  updatedAt: Date;
}

// ============================================================================
// Notification Types
// ============================================================================

export interface Notification {
  id: number;
  userId: string;
  type: NotificationType;
  title: string;
  body: string;
  data: Record<string, unknown>;
  isRead: boolean;
  readAt: Date | null;
  createdAt: Date;
}

export type NotificationType =
  | 'streak_reminder'
  | 'streak_at_risk'
  | 'streak_milestone'
  | 'daily_reading'
  | 'journey_continue'
  | 'group_discussion'
  | 'group_lab_reminder'
  | 'prayer_request'
  | 'accountability_checkin'
  | 'goal_milestone'
  | 'system';

// ============================================================================
// Common Types
// ============================================================================

export type ContentCategory =
  | 'faith'
  | 'prayer'
  | 'scripture'
  | 'relationships'
  | 'marriage'
  | 'parenting'
  | 'leadership'
  | 'career'
  | 'finances'
  | 'health'
  | 'mental_health'
  | 'purpose'
  | 'community'
  | 'evangelism'
  | 'discipleship';

export type DifficultyLevel = 'beginner' | 'intermediate' | 'advanced';

// ============================================================================
// API Types
// ============================================================================

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
  nextCursor?: string;
}

export interface ApiError {
  code: string;
  message: string;
  details?: Record<string, unknown>;
  statusCode: number;
}

export interface ApiSuccess<T> {
  data: T;
  message?: string;
}

// ============================================================================
// Event Types (for analytics and workflows)
// ============================================================================

export interface UserEvent {
  id: string;
  userId: string;
  eventType: EventType;
  eventData: Record<string, unknown>;
  sessionId: string | null;
  deviceInfo: DeviceInfo | null;
  createdAt: Date;
}

export type EventType =
  | 'page_view'
  | 'reading_plan_started'
  | 'reading_plan_day_completed'
  | 'reading_plan_completed'
  | 'journey_started'
  | 'journey_day_completed'
  | 'journey_completed'
  | 'goal_created'
  | 'goal_completed'
  | 'habit_completed'
  | 'journal_entry_created'
  | 'group_joined'
  | 'discussion_posted'
  | 'prayer_request_created';

export interface DeviceInfo {
  platform: 'web' | 'ios' | 'android';
  browser?: string;
  os?: string;
  screenSize?: string;
}